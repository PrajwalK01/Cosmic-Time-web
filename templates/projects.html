{% extends "base.html" %}

{% block content %}
<div class="page-container" id="projects-page">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <h2 class="section-title">All Repositories</h2>
        <a href="https://github.com/PrajwalK01" target="_blank" class="btn" style="font-size: 0.9rem;">View Profile <i
                class="fab fa-github"></i></a>
    </div>

    <div class="projects-grid" id="repos-container">
        <!-- Projects will be injected here via JS -->
        <div style="grid-column: 1/-1; text-align: center; color: var(--neon-blue); padding: 50px;">
            <i class="fas fa-circle-notch fa-spin fa-3x"></i>
            <p style="margin-top: 15px; font-family: var(--font-hack);">Scanning GitHub Sector...</p>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const container = document.getElementById('repos-container');
        const username = 'PrajwalK01';

        try {
            const response = await fetch(`https://api.github.com/users/${username}/repos?sort=updated&per_page=100`);
            if (!response.ok) throw new Error('Network response was not ok');

            const repos = await response.json();

            // Clear loading spinner
            container.innerHTML = '';

            repos.forEach(repo => {
                // Skip forked repos if preferred, or keep all
                // if (repo.fork) return; 

                const card = document.createElement('div');
                card.className = 'project-card';
                card.onclick = () => window.open(repo.html_url, '_blank');

                card.innerHTML = `
                <h3><i class="fas fa-book-bookmark" style="font-size: 0.9em; margin-right: 8px;"></i>${repo.name}</h3>
                <p>${repo.description || 'No description provided.'}</p>
                <div class="repo-stats">
                    ${repo.language ? `<span><i class="fas fa-code"></i> ${repo.language}</span>` : ''}
                    <span><i class="fas fa-star"></i> ${repo.stargazers_count}</span>
                    <span><i class="fas fa-code-branch"></i> ${repo.forks_count}</span>
                </div>
            `;

                container.appendChild(card);
            });

            if (repos.length === 0) {
                container.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">No public repositories found.</p>';
            }

        } catch (error) {
            console.error('Error fetching repos:', error);
            container.innerHTML = `<p style="text-align: center; color: #ff5555; grid-column: 1/-1;">
            Error connecting to GitHub. <br>
            <a href="https://github.com/${username}" target="_blank" style="color: var(--neon-blue);">Visit GitHub Profile Directly</a>
        </p>`;
        }
    });
</script>
{% endblock %}